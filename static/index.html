<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sine Wave Plot</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
</head>
<body>
    <button id="startSimulation">Start Simulation</button>
    <div id="plot"></div>

    <script src="wasm_exec.js"></script>
    <script>
        const go = new Go(); // Instantiate the Go instance
        let mod, inst;
        WebAssembly.instantiateStreaming(fetch('solver_tests.wasm'), go.importObject).then((result) => {
            mod = result.module;
            inst = result.instance;
            go.run(inst);
	    document.getElementById('startSimulation').addEventListener('click', runSimulation);
        });
	
	async function runSimulation() {
		let isRunning = true;
		let currentTime = 0.0;
		let dt = getTimeStep();
		const tFinal = dt * 10;
		const nSteps = 1000;
		const updateDelay = 100;

		while (isRunning && currentTime < tFinal){
			const newState = runWaveEquation(nSteps);
			updatePlot(JSON.parse(newState), currentTime);
			currentTime += dt;
			if (currentTime >= tFinal) isRunning = false;
			await new Promise(resolve => setTimeout(resolve, updateDelay));
		}
	}

	function updatePlot(newState, t) {
		titleString = "Wave Simulation, t=" + t.toString();
		Plotly.react('plot', [{
			x: newState.x,
			y: newState.f,
			type: 'scatter'
		}], {
			title: titleString,
			yaxis: {
				range: [-1.2, 1.2]
			}
		});
	}
    </script>
</body>
</html>
